\input{style.tex}

\title{Lab 02 report}
\author{Sergey}

\date{\today}

\begin{document}
\thispagestyle{empty}

\noindent \begin{minipage}{0.15\textwidth}
	\includegraphics[width=\linewidth]{b_logo}
\end{minipage}
\noindent\begin{minipage}{0.85\textwidth}\centering
	\textbf{Министерство науки и высшего образования Российской Федерации}\\
	\textbf{Федеральное государственное бюджетное образовательное учреждение высшего образования}\\
	\textbf{«Московский государственный технический университет имени Н.Э.~Баумана}\\
	\textbf{(национальный исследовательский университет)»}\\
	\textbf{(МГТУ им. Н.Э.~Баумана)}
\end{minipage}

\noindent\rule{16cm}{3pt}
\newline\newline
\noindent ФАКУЛЬТЕТ $\underline{\text{«Информатика и системы управления»}}$ \newline\newline
\noindent КАФЕДРА $\underline{\text{«Программное обеспечение ЭВМ и информационные технологии»}}$\newline


\begin{center}
	\noindent\begin{minipage}{1.3\textwidth}\centering
	\Large\textbf{   ~~~ Лабораторная работа №5}\newline
	\textbf{по дисциплине "Анализ Алгоритмов"}\newline\newline\newline
	\end{minipage}
\end{center}

\noindent\textbf{Тема} $\underline{\text{Конвейерная обработка}}$\newline\newline
\noindent\textbf{Студент} $\underline{\text{Сабуров С. М.}}$\newline\newline
\noindent\textbf{Группа} $\underline{\text{ИУ7-53Б}}$\newline\newline
\noindent\textbf{Преподаватель} $\underline{\text{Волкова Л. Л.}}$\newline

\begin{center}
	\mbox{}
	\vfill
	Москва
\end{center}

\begin{center}
	\the\year ~г.
\end{center}
\clearpage

\renewcommand\contentsname{\hfill{\normalfont{СОДЕРЖАНИЕ}}\hfill}  %Оглавление
\tableofcontents
\newpage

\anonsection{Введение}

На сегодняшний день в мире существует огромное количество задач, решение которых
требует использования больших вычислительных мощностей, которые чаще всего
недоступны в современных вычислительных системах. В связи с этим, возрастают
требования к точности и к скорости решения таких задач. На помощь приходит создание параллельных вычислительных систем, в которых предусмотрена одновременная реализация ряда вычислительных процессов, связанных с решением одной задачи, что на сегодняшний день является одним из основных способов ускорения вычислений. При таком подходе увеличение производительности достигается путем параллельного выполнения частей более сложной задачи.



Целью данной работы является получение навыка реализации метода конвейерных
вычислений.



Для достижения поставленной цели необходимо выполнить следующие задачи:
\begin{itemize}
    \item описать методы обработки данных и  сопоставить их с  методами конвейера.
    \item привести схемы конвейера.
    \item реализовать конвейерную систему, описать данную реализацию.
    \item сравнить  временные характеристики экспериментально.
    \item на основании проделанной работы сделать выводы.
\end{itemize}

\section{Аналитическая часть}






В данном разделе будет описана идея конвейерной обработки.

\subsection{Конвейерная обработка}
Конвейеризация – это техника, в результате которой задача или команда разбивается на некоторое число подзадач, которые выполняются
последовательно. Каждая подкоманда выполняется на своем логическом
устройстве. Все логические устройства (ступени) соединяются последовательно и работают одновременно. Множество ступеней называется
конвейером. Выигрыш во времени достигается при выполнении нескольких
задач за счет параллельной работы ступеней, вовлекая на каждом такте
новую задачу или команду.


\subsection{Область применения}
	Для данной лабораторной работы был разработан алгоритм шифрования строк, состоящий из трех этапов:
	
	\begin{itemize}
    \item шифрование методом цезаря.
    \item алгоритм, в котором к символу строки прибавляется сумма порядковых номеров символов всей строки из таблицы ASCII и порядковый номер  символа в строке(индекс).
    \item алгоритм перестановки двух соседних символов.
\end{itemize} . \subsection{Вывод}

В данном разделе была поставлена задача реализации  конвейерных вычислений . Была описана идея конвейеризации. 

\begin{itemize}
	\item Входные данные :количество слов в тексте.
	\item Выходные данные : на выходе имеем зашифрованный текст.
	\item Ограничения, в рамках которых будет работать программа : количество слов должно быть задано натуральным числом.
	\item Функциональные требования : функции, представленные на листингах 1 - 3 должны корректно шифровать исходный текст.
	\item Требования к программному обеспечению : к программе предъявляется ряд требований:
			\begin{itemize}
			    \item на вход подается количество слов, размер слова задан константой, программа сама генерирует слова, необязательно осмысленные;
			    \item на выходе - результат конвейеронго шифрования.
			\end{itemize}
\end{itemize}

\section{Конструкторская часть}
В данном разделе будут приведены схемы  алгоритмов, описание структур данных, способы тестирования и классы эквивалентности.

\subsection{Разработка алгоритмов}

На рисунках \ref{img:classic}-\ref{img:parallel} приведены схемы работы конвейера и его составных частей.

\subsection{Описание структур данных}
Конвейер был преставлен в виде очереди. Текст хранился в виде массива строк.

\subsection{Способы тестирования и классы эквивалентности}
Была выбрана методика тестирования черным ящиком. 
Классы эквивалентности:
\begin{itemize}
	\item Текст состоит из 1 строки.
	\item Текст состоит из 0 строк.
	\item Текст состоит из n строк, n - натуральное число.
	\item Задано количество строк - не натуральное число.
\end{itemize}
\subsection{Вывод}

На основе теоретических данных, полученных из аналитического раздела, были построены схемы требуемых алгоритмов, описаны стртуктуры данных, выделены способы тестирования и классы эквивалентности.

\begin{figure}
    \centering
    \includegraphics[scale=0.75]{shema_1.png}
    \caption{Схема запуска конвейера.}
    \label{img:classic}
\end{figure}

\begin{figure}
    \centering
    \includegraphics[scale=0.75]{schema_2.png}
    \caption{Схема работы ленты конвейера}
    \label{img:parallel}
\end{figure}



\section{Технологическая часть}

В данном разделе приведены требования к программному обеспечению, средства реализации и листинги кода.



\subsection{Средства реализации}


Для реализации программ был выбран язык программирования C++ [1]. Данный язык был выбран потому, что в нем присутствует инструментарий для замера процессорного времени и тестирования.


\begin{lstlisting}[caption=Первый алгоритм шифрование: Метод цезаря, label=list:canon, language={}]
string encrypt_1(string s)
{
	
	for (int i = 0; i < s.length(); i++)
	{
		try
		{

			if (s[i] == 'z')
			{
				s[i] = 'a';
			}
			else if (s[i] == 'Z')
				s[i] = 'A';
			else
				s[i] = s[i] + 1;
		}
		catch(...)
		{
			cout << "ENCRYPT 1" << s << endl;
		}

	}
	return s;
}\end{lstlisting}
\begin{lstlisting}[caption=Второй алгоритм шифрование: Пользовательский метод, описанный в аналитическом разделе, label=list:canon, language={}]
string encrypt_2(string s)
{
	

	int sum = 0;
	for (int i = 0; i < s.length(); i++)
	{
		sum += s[i];
	}
	for (int i = 0; i < s.length(); i++)
	{
		try
		{

			if (s[i] >= 'a' && s[i] <= 'z')
			{
				s[i] = (s[i] + sum + i) % ('z' - 'a') + 'a';

			}
			else if (s[i] >= 'A' && s[i] <= 'Z')
			{
				s[i] = (s[i] + sum + i) % ('Z' - 'A') + 'A';
			}
		}
		catch (...)
		{
			cout << "ENCRYPT 2 " << s << endl;
		}
		
	}
	return s;
}
\end{lstlisting}
\begin{lstlisting}[caption=Третий алгоритм шифрование: Перестановка соседних символов, label=list:canon, language={}]
string encrypt_3(string s)
{
	if (s.length() > 0)
	{

		for (int i = 0; i < s.length() - 1; i+= 2)
		{
			try
			{
				char tmp = s[i];
				s[i] = s[i + 1];
				s[i + 1] = tmp;
			}
			catch (...)
			{
				cout << "ENCRYPT 3" << s << endl;
			}
		}
	}
	return s;
}
\end{lstlisting}
\begin{lstlisting}[caption=Реализация первой ленты конвейера, label=list:canon, language={}]
void ft_line()
{

	int num = 0;

	while (true) {
		if (num == n)
			break;
		m1.lock();
		if (q1.empty()) {
			m1.unlock();
			continue;
		}
		string cur_str  = q1.front();
		q1.pop();

		m1.unlock();
		string new_str = encrypt_1(cur_str);
		m2.lock();
		
		q2.push(new_str);
		m2.unlock();
		num++;
	}


}

\end{lstlisting}

\begin{lstlisting}[caption=Реализация второй ленты конвейера, label=list:canon, language={}]
void sc_line()
{
	int num = 0;
	while (true) {
		if (num == n)
			break;
		m2.lock(); // wait in queue
		if (q2.empty()) {
			m2.unlock();
			continue;
		}
		string cur_str = q2.front();
		q2.pop();

		m2.unlock();
		string new_str = encrypt_2(cur_str);
		m3.lock();
		
		q3.push(new_str);
		m3.unlock();
		num++;
	}
}
\end{lstlisting}

\begin{lstlisting}[caption=Реализация третий ленты конвейера, label=list:canon, language={}]
void thd_line()
{
	int num = 0;
	while (true) {
		if (num == n)
			break;
		m3.lock(); // wait in queue
		if (q3.empty()) {
			m3.unlock();
			continue;
		}
		string cur_str = q3.front();
		q3.pop();

		m3.unlock();
		string new_str = encrypt_3(cur_str);
		resm.lock();
		
		q_final.push(new_str);
		resm.unlock();
		num++;
	}
}
\end{lstlisting}



\subsection{Тестирование функций}

В таблице \ref{tab:tests} приведены модульные тесты для функций шифрования текста. Все тесты были пройдены успешно. \\

\begin{table}[hb]
    \caption{\centering Тестирование функций шифрования строки}
    \centering
    \begin{tabular}{|c|c|}
    \hline
    Исходная строка & Ожидаемый результат \\ \hline
    %$\begin{pword}
        Hello & iDrqv \\ \hline
        123 & 324 \\ \hline
        H & V \\ \hline
        hello world & idrqv nnmrf \\ \hline
        <Пустая строка> & Шифрование невозможно \\ \hline
    %\end{pword}$
    \end{tabular}
    \label{tab:tests}
    \end{table}

\subsection{Вывод}

Были разработаны реализации алгоритмов шифрования и конвейеризации соотвественно. Также были протестированы реализации алгоритмов шифрования.

\section{Исследовательская часть}
В данном разделе будут приведены результаты исследовательской деятельности - замеры процессорного времени работы алгоритмов и тестирование алгоритмов.

\subsection{Технические характеристики}

Технические характеристики электронно-вычислительнй машины, на которой выполнялось тестирование:

\begin{itemize}
    \item операционная система: Windows 10 64-bit;
    \item оперативная память: 8 гигабайт ;
    \item процессор: Intel i5 7th gen.
\end{itemize}


Тестирование проводилось на ноутбуке, включенном в сеть электропитания. Во время тестирования ноутбук был нагружен только встроенными приложениями окружения рабочего стола, окружением рабочего стола, а также непосредственно системой тестирования.

\subsection{Время выполнения алгоритмов}

Был проведен замер времени работы каждого из алгоритмов с помощью функции std::chrono::system clock::now. Эта функция замеряет процессорное время выполнения функции и усредняет его (проводится 10 замеров). В таблице \ref{tab:time_best} содержатся результаты исследований. В таблице \ref{tab:time_log} содержится лог программы.

На рисунке \ref{img:plot_best} демонстрируется зависимость времени выполнения последовательного и конвейерного алгоритмов от количества строк. \\

\begin{table}[ht]
    \caption{\centering Время выполнения реализаций алгоритмов (в секундах) при количестве символов в строке 5000.}
    \centering
    \begin{tabular}{|c|c|c|c|}
    \hline
    Кол-во строк & К      & П     \\ \hline
    100    & 0.246199 & 0.555688 \\ \hline
    500    & 1.15154 & 2.75488  \\ \hline
    1000    & 2.36791  & 5.77721  \\ \hline
    2500    & 5.80938  & 14.0969  \\ \hline
    5000    & 11.7832  & 28.8174  \\ \hline
    10000    & 24.1511  & 55.4429  \\ \hline
 
    \end{tabular}
    \label{tab:time_best}
\end{table}


\begin{table}[ht]
    \caption{\centering Лог программы при количестве строк 5.}
    \centering
    \begin{tabular}{|c|c|c|c|c|}
    \hline
    Линия № & Строка №     & Время начала (мс)  & Время конца (мс)  \\ \hline
    1    & 0 & 7.227e+06   & 7.2795e+06 \\ \hline
    2    & 0 & 1.3869e+07   & 1.39594e+07\\ \hline
    1    & 1 & 1.39611e+07   & 1.39689e+07\\ \hline
    3    & 0 & 1.8941e+07 & 1.89564e+07 \\ \hline
    1    & 2 & 2.03209e+07  & 2.0327e+07\\ \hline
    2    & 1 & 2.03243e+07  & 2.03323e+07\\ \hline
    1    & 3 & 2.32028e+07  & 2.32085e+07\\ \hline
    2    & 2 & 2.6129e+07  & 2.61349e+07\\ \hline
    3    & 1 & 2.66033e+07  & 2.66153e+07\\ \hline
    1    & 4 & 2.76257e+07  & 2.7632e+07\\ \hline
    2    & 3 & 3.13649e+07  &3.13702e+07\\ \hline
    3    & 2 & 3.75349e+07  & 3.21479e+07\\ \hline
    2    & 4 & 3.75349e+07  & 3.75402e+07\\ \hline
    3    & 3 &3.75711e+07  & 3.75798e+07\\ \hline
    3    & 4 & 4.19849e+07  & 4.19913e+07\\ \hline
    \end{tabular}
    \label{tab:time_log}
\end{table}

\begin{figure}
    \centering
    \includegraphics[scale=0.85]{plot.png}
    \caption{Зависимость времени выполнения алгоритмов от количества строк}
    \label{img:plot_best}
\end{figure}

\subsection{Вывод}

В данном разделе было произведено сравнение количества затраченного времени вышеизложенных алгоритмов.
Конвейерная реализация значительно выигрывает
по времени в сравнении с  линейной реализации. Как видно из рисунка 4, линейная
реализация примерно в 2 раза медленнее параллельной при 10000 строках.


\anonsection{Заключение}


В ходе выполнения работы была достигнута цель выполнены все поставленные задачи:

\begin{itemize}
    \item описать методы обработки данных и  сопоставить их с  методами конвейера.
    \item привести схемы конвейера.
    \item Реализовать конвейерную систему, описать данную реализацию
    \item сравнить  временные характеристики экспериментально;
    \item на основании проделанной работы сделать выводы.
\end{itemize}

Экспериментально были установлены различия в производительности алгоритмов. Конвейерный алгоритм  имеет большую эффективность, нежели линейный алгоритм. 
\anonsection{Список литература}

	\begin{enumerate}

		\item Т. Кормен, Ч. Лейзерсон, Р. Ривест, К. Штайн. Алгоритмы. Построение и анализ. Издательский дом ``Вильямс'', 2011. 282 - 315.
		\item Б. Страуструп. Язык программирования С++ . Addison-Wesley, 2000. 257 - 279.
		\item Конвейерные вычисления [Электронный ресурс].Режим доступа: http://www.myshared.ru/slide/674082 
		\item Корнеев В.В. Параллельные вычислительные системы. М., 1999. 320 с.
		\item Р. Седжвик. Фундаментальные алгоритмы С++. Diasoft, 2001. 567 - 597.

	\end{enumerate}

\end{document}
